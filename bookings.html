<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Bookings - LuxStay</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      .page-hero {
        background: var(--primary-gradient);
        padding: 8rem 0 4rem;
        color: white;
        text-align: center;
      }

      .bookings-container {
        min-height: calc(100vh - 500px);
        padding: 3rem 0;
      }

      .booking-card {
        background: var(--bg-card);
        border-radius: var(--border-radius);
        padding: 2rem;
        box-shadow: var(--shadow-md);
        margin-bottom: 1.5rem;
        transition: var(--transition);
      }

      .booking-card:hover {
        box-shadow: var(--shadow-lg);
        transform: translateY(-3px);
      }

      .booking-card.cancelled {
        opacity: 0.6;
      }

      .booking-image {
        height: 180px;
        background-size: cover;
        background-position: center;
        border-radius: 12px;
      }

      .status-badge {
        padding: 0.5rem 1.25rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        display: inline-block;
      }

      .status-badge.confirmed {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
      }

      .status-badge.cancelled {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
      }

      .booking-detail {
        margin-bottom: 1rem;
      }

      .booking-detail .label {
        color: var(--text-light);
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
      }

      .booking-detail .value {
        color: var(--text-dark);
        font-weight: 600;
        font-size: 1rem;
      }

      .empty-state {
        text-align: center;
        padding: 5rem 2rem;
      }

      .empty-state i {
        font-size: 5rem;
        color: #cbd5e0;
        margin-bottom: 1.5rem;
        opacity: 0.5;
      }

      .empty-state h3 {
        color: var(--text-dark);
        font-size: 2rem;
        margin-bottom: 1rem;
      }

      .empty-state p {
        color: var(--text-light);
        font-size: 1.1rem;
        margin-bottom: 2rem;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
      <div class="container">
        <a class="navbar-brand" href="index.html">
          <i class="fas fa-gem"></i> LuxStay
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="browse.html">Hotels</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="bookings.html">My Bookings</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="favorites.html">
                <i class="fas fa-heart"></i> Favorites
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contact.html">Contact</a>
            </li>
            <li class="nav-item">
              <a class="nav-link position-relative" href="cart.html">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-count" id="cartCount">0</span>
              </a>
            </li>
            <li class="nav-item">
              <button class="theme-btn" onclick="toggleTheme()">
                <i class="fas fa-moon" id="themeIcon"></i>
              </button>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Hero -->
    <div class="page-hero">
      <div class="container">
        <h1 style="font-size: 3rem; font-weight: 700; margin-bottom: 1rem">
          <i class="fas fa-calendar-check me-3"></i>My Bookings
        </h1>
        <p style="font-size: 1.2rem; opacity: 0.9">
          View and manage your hotel reservations
        </p>
      </div>
    </div>

    <!-- Main Content -->
    <div class="bookings-container">
      <div class="container">
        <div id="bookingsList">
          <!-- Bookings will be loaded here -->
        </div>
        <div class="text-end mb-4">
          <button
            class="btn btn-danger"
            id="deleteCancelledBtn"
            onclick="deleteCancelledBookings()"
          >
            <i class="fas fa-trash-alt me-2"></i> Delete Cancelled Bookings
          </button>
        </div>

        <div id="emptyBookings" class="empty-state" style="display: none">
          <i class="fas fa-calendar-times"></i>
          <h3>No bookings yet</h3>
          <p>Start booking your dream hotels today!</p>
          <a href="browse.html" class="btn-primary-custom">
            <i class="fas fa-hotel me-2"></i> Browse Hotels
          </a>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="row g-4">
          <div class="col-md-4">
            <h5 class="footer-title"><i class="fas fa-gem"></i> LuxStay</h5>
            <p>
              Your gateway to luxury accommodations worldwide. Experience the
              finest hotels at the best prices.
            </p>
            <div class="social-links">
              <a href="https://t.me/dzhangazy"
                ><i class="fab fa-telegram"></i
              ></a>
              <a href="https://www.instagram.com/dbktzhvn/"
                ><i class="fab fa-instagram"></i
              ></a>
              <a href="https://github.com/dzhangazy"
                ><i class="fab fa-github"></i
              ></a>
              <a href="https://linkedin.com/in/bakytzhan-jangazy-50b337372"
                ><i class="fab fa-linkedin-in"></i
              ></a>
            </div>
          </div>
          <div class="col-md-2">
            <h6 class="footer-subtitle">Quick Links</h6>
            <ul class="footer-links">
              <li><a href="index.html">Home</a></li>
              <li><a href="browse.html">Hotels</a></li>
              <li><a href="bookings.html">My Bookings</a></li>
              <li><a href="contact.html">Contact</a></li>
            </ul>
          </div>
          <div class="col-md-3">
            <h6 class="footer-subtitle">Support</h6>
            <ul class="footer-links">
              <li>
                <a href="https://www.ihg.com/content/us/en/customer-care/main"
                  >Help Center</a
                >
              </li>
              <li>
                <a href="https://www.marriott.com/about/terms-of-use.mi"
                  >Terms of Service</a
                >
              </li>
              <li>
                <a
                  href="https://www.marriott.com/about/privacy.mi?adobe_mc=MCMID%3D66712657228795457689090308981152108373%7CMCORGID%3D664516D751E565010A490D4C%2540AdobeOrg%7CTS%3D1762853635"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a href="https://cityloungehotel.com/en/cancellation-policy"
                  >Cancellation Policy</a
                >
              </li>
            </ul>
          </div>
          <div class="col-md-3">
            <h6 class="footer-subtitle">Contact Info</h6>
            <ul class="footer-contact">
              <li><i class="fas fa-envelope"></i> info@luxstay.com</li>
              <li><i class="fas fa-phone"></i> +7 (123) 456-7890</li>
              <li><i class="fas fa-map-marker-alt"></i> Astana, Kazakhstan</li>
            </ul>
          </div>
        </div>
        <hr class="footer-divider" />
        <div class="footer-bottom">
          <p>
            &copy; 2024 LuxStay. All rights reserved. | Final Project - Astana
            IT University
          </p>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="data.js"></script>
    <script src="storage.js"></script>
    <script src="theme.js"></script>
    <script src="main.js"></script>
    <script>
      // Load bookings on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadBookings();
      });

      function loadBookings() {
        const bookings = getBookings();
        const container = document.getElementById("bookingsList");
        const emptyState = document.getElementById("emptyBookings");

        if (bookings.length === 0) {
          container.style.display = "none";
          const deleteBtn = document.getElementById("deleteCancelledBtn");
          const hasCancelled = bookings.some((b) => b.status === "cancelled");
          deleteBtn.style.display = hasCancelled ? "inline-block" : "none";

          emptyState.style.display = "block";
          return;
        }

        container.style.display = "block";
        emptyState.style.display = "none";

        container.innerHTML = bookings
          .map(
            (booking) => `
                <div class="booking-card ${
                  booking.status === "cancelled" ? "cancelled" : ""
                }">
                    <div class="row g-4">
                        <div class="col-md-3">
                            <div class="booking-image" style="background-image: url('${
                              booking.hotel.image
                            }')"></div>
                        </div>
                        <div class="col-md-9">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h4 style="color: var(--text-dark); margin-bottom: 0.5rem;">${
                                      booking.hotel.name
                                    }</h4>
                                    <p style="color: var(--text-light); margin: 0;">
                                        <i class="fas fa-map-marker-alt me-1"></i> ${
                                          booking.hotel.location
                                        }
                                    </p>
                                </div>
                                <span class="status-badge ${booking.status}">
                                    ${booking.status.toUpperCase()}
                                </span>
                            </div>
                            
                            <div class="row g-3 mb-3">
                                <div class="col-md-3">
                                    <div class="booking-detail">
                                        <div class="label">Check-in</div>
                                        <div class="value">${formatDate(
                                          booking.checkIn
                                        )}</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="booking-detail">
                                        <div class="label">Check-out</div>
                                        <div class="value">${formatDate(
                                          booking.checkOut
                                        )}</div>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="booking-detail">
                                        <div class="label">Nights</div>
                                        <div class="value">${
                                          booking.nights
                                        }</div>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="booking-detail">
                                        <div class="label">Guests</div>
                                        <div class="value">${
                                          booking.guests
                                        }</div>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="booking-detail">
                                        <div class="label">Total Price</div>
                                        <div class="value" style="color: var(--primary-color); font-size: 1.2rem;">
                                            ${formatPrice(booking.totalPrice)}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row g-3 mb-3">
                                <div class="col-md-4">
                                    <div class="booking-detail">
                                        <div class="label">Guest Name</div>
                                        <div class="value">${
                                          booking.guestName
                                        }</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="booking-detail">
                                        <div class="label">Email</div>
                                        <div class="value">${
                                          booking.guestEmail
                                        }</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="booking-detail">
                                        <div class="label">Booking Date</div>
                                        <div class="value">${new Date(
                                          booking.bookingDate
                                        ).toLocaleDateString()}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex gap-2">
                                <a href="hotel-details.html?id=${
                                  booking.hotel.id
                                }" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-eye me-1"></i> View Hotel
                                </a>
                                ${
                                  booking.status === "confirmed"
                                    ? `
                                    <button class="btn btn-sm btn-outline-danger" onclick="handleCancelBooking(${booking.id})">
                                        <i class="fas fa-times me-1"></i> Cancel Booking
                                    </button>
                                `
                                    : ""
                                }
                            </div>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function handleCancelBooking(bookingId) {
        if (confirm("Are you sure you want to cancel this booking?")) {
          cancelBooking(bookingId);
          loadBookings();
          showToast("Booking cancelled successfully", "info");
        }
      }
      function deleteCancelledBookings() {
        // Подтверждение можно оставить или убрать по желанию
        // if (!confirm("Are you sure you want to delete all cancelled bookings?")) return;

        let bookings = getBookings(); // Получаем все бронирования
        const activeBookings = bookings.filter((b) => b.status !== "cancelled"); // Убираем отменённые

        saveBookings(activeBookings); // Сохраняем обновлённый список
        renderBookings(activeBookings); // ⬅️ Обновляем DOM немедленно
        showToast("Cancelled bookings removed successfully", "success");
      }
      function renderBookings(bookings) {
        const list = document.getElementById("bookingsList");
        list.innerHTML = ""; // очищаем контейнер

        if (bookings.length === 0) {
          list.innerHTML = "<p class='text-muted'>No bookings found.</p>";
          return;
        }

        bookings.forEach((b) => {
          const card = document.createElement("div");
          card.className = "card mb-3";
          card.innerHTML = `
      <div class="card-body">
        <h5 class="card-title">${b.hotelName}</h5>
        <p class="card-text">Check-in: ${b.checkIn} | Check-out: ${b.checkOut}</p>
        <p class="card-text"><strong>Status:</strong> ${b.status}</p>
      </div>
    `;
          list.appendChild(card);
        });
      }
    </script>
  </body>
</html>
